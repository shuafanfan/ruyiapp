<php>$mobile_title = $detail['title'];</php>
<include file='public:header'/>   
<style>
.top-fixed{background:linear-gradient(rgba(0,0,0,.5),rgba(0,0,0,0))!important;position:absolute;border:none}
.cartadd_num{font-size:12px}
.navContent{display:block}
.ui-sx{width:100%;overflow:hidden}
.subNavBox{overflow:hidden;margin-left:10px;padding-bottom:0;margin-right:10px}
.subNav{background:url(../images/arrow_down_off.png) no-repeat right center;background-size:auto 13px}
.subNav.on{background:url(../images/arrow_down_on.png) no-repeat right center;background-size:auto 14px}
.subNav strong{display:block;width:100%;height:40px;border-bottom:1px solid #eee;color:#666;font-weight:400;font-size:16px;line-height:40px}
.currentDt{background-image:url(../images/jiantou2.png) no-repeat 97% center;background-size:auto 13px}
.navContent li{overflow:hidden;width:100%}
.navContent li .title{width:100%;font-size:16px;line-height:30px;color:#666;margin-top:5px}
.navContent li .item{overflow:hidden;border-bottom:1px solid #eee;padding-bottom:5px}
.navContent li .item a{padding-left:10px;padding-right:10px;border:1px solid #CCC;line-height:30px;display:inline-block;-moz-border-radius:2px;-webkit-border-radius:2px;border-radius:2px;margin-right:5px;margin-bottom:10px}
.navContent li .item a.hover{background:red;color:#FFF;border:1px solid red;-moz-border-radius:2px;-webkit-border-radius:2px;border-radius:2px}
.navContent li .purchase{font-size:14px;line-height:25px;color:#666}
.navContent li .purchase_v{font-size:16px;line-height:25px;color:#dd2724;font-weight:700}
.navContent li h2{font-size:18px;line-height:30px;color:#333;font-weight:400}
.navContent li p{width:95%;overflow:hidden;height:25px;line-height:25px;margin:auto}
.navContent li .key{display:block;float:left;width:30%;font-size:14px;color:#666;text-align:right}
.navContent li .p-price-v{display:block;width:70%;float:left;font-size:16px;color:#dd2724}
.navContent li .title1{width:100%;font-size:16px;height:20px;line-height:20px;color:#666;padding-top:10px}
.navContent li .item1{width:100%;height:50px;overflow:hidden;padding-bottom:5px}
.navContent li .item1 a{padding-left:10px;padding-right:10px;border:1px solid #CCC;line-height:30px;display:inline-block;-moz-border-radius:2px;-webkit-border-radius:2px;border-radius:2px;margin-right:5px;margin-bottom:10px}
.navContent li .item1 a.hover{background:red;color:#FFF;border:0;-moz-border-radius:5px;-webkit-border-radius:5px;border-radius:5px}
.navContent li .item1 .ui-number{border:1px solid #ddd9da;overflow:hidden;height:30px;display:block;width:106px;margin-top:10px}
.navContent li .item1 .ui-number .decrease{display:inline-block;background:0 0;font-size:24px;line-height:30px;border:0;width:30px;float:left;height:30px;color:#F8849C;border-right:1px solid #ddd9da;text-indent:-9999px;background:url(__PUBLIC__/images/shop-cart.png) no-repeat 6px -25px;background-size:60px}
.navContent li .item1 .ui-number .num{display:inline-block;border:0;width:40px;height:30px;float:left;text-align:center;font-size:12px;line-height:30px;color:#666;font-size:20px;text-align:center}
.navContent li .item1 .ui-number .increase{display:inline-block;background:0 0;border:0;border-left:1px solid #ddd9da;float:right;width:30px;height:30px;font-size:24px;line-height:30px;color:#F8849C;background:url(__PUBLIC__/images/shop-cart.png) no-repeat -23px -25px;background-size:60px;text-indent:-9999px}
.row{padding:15px 10px}
.tuan-detail2{border-top:0 solid #eee}
.txt-small .txt{border:none}
.margin-small-top2{margin-top:5px}
.buy_area .detail_coupons,.detail_baitiao{position:relative;padding:0 30px 0 10px;height:42px;line-height:42px;font-size:0;color:#999;word-break:break-word;overflow:hidden}
.buy_area .detail_coupons span.num,.detail_baitiao span.num{float:right}
.buy_area .detail_coupons span,.detail_baitiao span{font-size:12px}
.buy_area .detail_coupons span.title,.detail_baitiao span.title{margin-right:16px}
.buy_area .detail_coupons .coupon,.detail_baitiao .coupon{position:relative;display:inline-block;margin-right:5px;padding:0 9px 0 12px;border-top:1px solid #e4393c;border-bottom:1px solid #e4393c;height:18px;line-height:18px;color:#e4393c;font-size:10px}
.buy_area .detail_coupons .coupon:before,.detail_baitiao .coupon:before{left:0;width:7px}
.buy_area .detail_coupons .coupon:after,.detail_baitiao .coupon:after{right:0;width:4px;background-position:-11px 0}
.buy_area .detail_coupons .coupon:after,.buy_area .detail_coupons .coupon:before,.detail_baitiao .coupon:after,.detail_baitiao .coupon:before{content:"";position:absolute;top:-1px;height:18px;background-image:url(/static/default/wap/image/mall/mall_iocn.png);background-size:15px 18px;background-repeat:no-repeat}

</style>
<script src="/static/default/wap/other/roll.js"></script>
	<header class="top-fixed bg-yellow bg-inverse">
		<div class="top-back">
			<a class="top-addr inner-back" href="<{:U('mall/index')}>"></a>
		</div>
		<div class="top-title">
			商品详情
		</div>
		<div class="top-share">
			<a href="<{:U('mall/cart')}>" class="inner-cart" id="share-btn"></a>
		</div>
	</header>
   
    
<div class="tuan-detail">
<div class="line banner">	
	<div id="focus" class="focus">
		<div class="hd">
			<ul></ul>
		</div>
		<div class="bd">
			<ul>
          		<li><a href="javascript:void(0);"><img src="<{:config_img($detail['photo'])}>" /></a></li>
                <foreach  name="pics" item="item">
                <li><a href="javascript:void(0);"><img src="<{:config_img($item['photo'])}>" /></a></li>
                </foreach>
			</ul>
		</div>
	</div>
   </div>
</div>             
	<script type="text/javascript">
		TouchSlide({ 
			slideCell:"#focus",
			titCell:".hd ul", 
			mainCell:".bd ul", 
			effect:"left", 
			autoPlay:true,//自动播放
			autoPage:true, //自动分页
			switchLoad:"_src" 
		});
	</script>

<div class="item-detail">
			<div class="detail-row bb">
				<div class="item-price">
                   <h1><{:bao_msubstr($detail['title'],0,24)}></h1>
					<p class="price" id="goods_price">&yen; <{:round($detail['mall_price']/100,2)}> 
                        <span class="pre-price-tips">
                        <php>$zhe = round($detail['mall_price']/$detail['price']*10,1);</php>
                        <if condition="$zhe neq 10">
                        	<span class="dt-icon"><{:round($detail['mall_price']/$detail['price']*10,1)}>折</span>
                        </if>
                                <if condition="!empty($detail['use_integral'])">
                                    <span class="dt-icon" style="background-color:#ff9204;">积分抵扣 &yen;
                                    
                                    <if condition="$CONFIG['integral']['buy'] eq 0">
                                        <{:round($detail['use_integral']/100,2)}>
                                    <elseif condition="$CONFIG['integral']['buy'] eq 10" />
                                        <{:round($detail['use_integral']/10,2)}>
                                    <elseif condition="$CONFIG['integral']['buy'] eq 100" />
                                        <{:round($detail['use_integral']/1,2)}>
                                    </if>
                                 
                                    </span>
                                </if>
                                <if condition="!empty($detail['mobile_fan'])">
                                    <span class="dt-icon" style="background-color: #F00;">下单立减 &yen;<{:round($detail['mobile_fan']/100,2)}></span>
                                </if>
                        </span>
                    </p>  
                                    
                    <div class="x12 price-tip">
                        <span class="text-gray">原价：<del>&yen; <{:round($detail['price']/100,2)}></del></span>
                        <span class="text-gray text-small">销量：<{$detail['sold_num']}>笔 </span>
                    </div>
                    <if condition="!empty($detail['sold_num']) && !empty($count_goodsfavorites)">
                        <div class="x12 price-tip">
                            <if condition="!empty($detail['sold_num'])">
                                <span class="dt-icon" style="background-color: #F00;">月售：<{$detail['sold_num']}> 笔</span>
                            </if>
                            <if condition="!empty($count_goodsfavorites)">
                                 <span class="dt-icon" style="background-color: #F00;">收藏人数： <{$count_goodsfavorites}> </span>
                            </if>
                        </div>
					</if>
				</div>
			</div>
            <if condition="!empty($is_vs)">
			<div class="detail-row bb">
				<div class="item-tips">
					<eq name="detail.is_vs1" value="1"><em><span class="text-green"><i class="check-circle"></i></span>认证商家</em></eq>
                    <eq name="detail.is_vs2" value="1"><em><span class="text-green"><i class="check-circle"></i></span>正品保证</em></eq>
                    <eq name="detail.is_vs3" value="1"><em><span class="text-green"><i class="check-circle"></i></span>假一赔十</em></eq>
                    <eq name="detail.is_vs4" value="1"><em><span class="text-green"><i class="check-circle"></i></span>当日送达</em></eq>
                    <eq name="detail.is_vs6" value="1"><em><span class="text-green"><i class="check-circle"></i></span>货到付款</em></eq>
                    <eq name="detail.is_vs5" value="1"><em><span class="text-green"><i class="check-circle"></i></span>免运费</em></eq>
				</div>
			</div>
           </if>
            
		</div>
       </div>
	   <if condition="!empty($coupon)"><!--如果看了又看不等于空-->	
           <div class="blank-10 bg"></div>
            <div class="buy_area" id="buyArea">
                <div class="detail_coupons" id="couponListDiv">
                    <span onclick="location='<{:U('shop/coupon',array('shop_id'=>$detail['shop_id']))}>'" class="num">共<{$mall_coupon_null}>张</span>
                    <span class="title">领券</span>
                    <volist name="coupon" id="item" key="index">
                    	<span onclick="location='<{:U('coupon/download',array('coupon_id'=>$item['coupon_id'],'type'=>1))}>'" class="coupon">满<{:round($item['full_price']/100,2)}>减<{:round($item['reduce_price']/100,2)}></span>
                    </volist>
                </div>
            </div>
      </if>  
      <div class="blank-10 bg"></div>  
        
        <!--商品属性-->
<if condition="!empty($filter_spec)">  
<section id="search_ka">
<!---属性---->
<div class="ui-sx bian1"> 
<div class="subNavBox"> 
	<div class="subNav"><strong>选择商品属性</strong></div>
    <ul class="navContent"> 
    <foreach item="spec" key="key" name="filter_spec">
    <li>   
          <div class="title"><{$key}></div>
          <div class="item">
          <foreach name="spec" item="v2" key="k2">
	          <a href="javascript:;" onclick="switch_spec(this);" title="<{$v2[item]}>" <if condition="$k2 eq 0">class="hover"</if>>
	          	<input type="radio" style="display:none;" name="goods_spec[<{$key}>]" value="<{$v2[item_id]}>" <if condition="$k2 eq 0 ">checked="checked"</if>/>
          		<{$v2[item]}>            
          	  </a>
           </foreach>
          </div>                    
    </li>
    </foreach>
       </ul>  
    </div>
    </div>    
</section> 
</if>

    <div class="x12 row">
		<span class="float-left margin-small-top2">购买数量：<span class="text-small text-gray"></span></span>
			<span class="float-right">
				<span class="txt txt-small radius-small bg-dot decrease" onClick="goods_cut();">-</span>
				<span class="txt-border txt-small radius-small border-gray">
                    <input type="text" class="txt txt-small radius-small  bg-white num"  id="goods_num" name="goods_num" value="1" min="1" max="1000"/>
                </span>
                <input type="hidden" name="goods_id" value="<{$goods.goods_id}>"/>
				<span class="txt txt-small radius-small bg-dot increase" onClick="goods_add();">+</span>
                <span>&nbsp;&nbsp;（库存<span id="stock"><{$detail['num']}></span>件）</span>
			</span>
	</div>
   
      <div class="blank-10"></div>
        <!--商品属性-->
        
       <div class="tuan-detail2">
       <div class="line status">
			<div class="x6">
				<span class="ui-starbar"><span style="width:<{:round($score*10,2)}>%"></span></span>
			</div>
			<div class="x6">
				<span class="float-right"><a href="<{:U('mall/dianping',array('goods_id'=>$detail['goods_id']))}>"><{$pingnum}>人评价了该商品 </a><i class="iconfont icon-angle-right"></i></span>
			</div>
		</div> 
       </div> 
        
		
		<div class="blank-10 bg"></div>
		
        
        <div class="item-intro">
			<h2>购买须知</h2>
			<div class="intro-bd"><{:cleanhtml($detail['instructions'])}></div>
		</div>
        <div class="blank-10 bg"></div>
        
		<div class="item-intro">
			<h2>商品介绍</h2>
            <div id="focus" class="global_focus intro-bd">
             <{$detail.details}>   
            </div>
		</div>		
		
        <if condition="!empty($recom)"><!--如果看了又看不等于空-->
          <div class="blank-10 bg"></div>
            <div class="item-list item-intro" id="item-list">
                <h2>看了又看</h2>
                <ul>
                <volist name="recom" id="item" key="index">
                <li class="line">
                    <a href="<{:U('mall/detail',array('goods_id'=>$item['goods_id']))}>">
                    <div class="x3">
                        <img src="<{:config_img($item['photo'])}>" />
                    </div>
                    <div class="x9">
                        <h5><{$item.title}></h5>
                        <p class="desc"><{:bao_Msubstr($item[instructions],0,60)}></p>
                        <p class="info">
                            <span>&yen;<{:round($item['mall_price']/100,2)}></span><del>&yen;<{:round($item['price']/100,2)}></del>
                            <em>已售<{$item.sold_num}></em>
                    </div>
                    </a>
                </li>
                </volist>
                </ul>
            </div>
        </if>
        
        
   
<div data-spm="action" class="item-action">
    <if condition="!empty($shop['qq'])">
        <div class="active-contact">
            <a data-spm="dwangwang" href="mqqwpa://im/chat?chat_type=wpa&uin=<{$shop['qq']}>">
            <span class="icon"></span>客服</a>
        </div>
    </if>
    
    <div class="<if condition="!empty($goodsfavorites)">toggle-collect-news<else/>toggle-collect</if>" >
        <a target="x-frame" href="<{:U('mall/favorites',array('goods_id'=>$detail['goods_id']))}>"> 
        <span class="icon"></span>收藏</a>
    </div>
    <div class="go-store">
        <a data-spm="dstore" href="<{:U('shop/detail',array('shop_id'=>$detail['shop_id']))}>">
        <span class="icon"></span>店铺</a>
    </div>
    <div id="bottom-cart-entrance" class="add-to-cart cartadd2">加入购物车</div>
     <if condition="$detail['num'] elt 0"> 
   	 <div class="buy-now "><a>暂无库存</a></div>
     <else/>
     <div class="buy-now"><a href="javascript:" class="buy_now">立即购买</a></div>
     </if>
</div>

<script>
        $(document).ready(function () {
        	
            $(".cartadd2").click(function(){
            	
               var url = "<{:U('mall/cartadd2')}>";
               var goods_id = "<{$detail.goods_id}>" ;
               var num = $("#goods_num").val();
               var shop_id = "<{$detail.shop_id}>";
               $.post(url,{goods_id:goods_id,shop_id:shop_id,spec_key:spec_key,num:num},function(data){
                   if(data.status == 'success'){
                       layer.msg(data.msg, function () {
                            setTimeout(function () {
                                window.location.reload(true);
                            }, 1000)
                        });
                   }else{
                       layer.msg(data.msg);
                   }
               },'json')
           })
           
           $(document).on('click', '.buy_now', function () {
                                var num = $("#goods_num").val();
                                var goods_id = "<{$detail.goods_id}>";
                                var url = '__ROOT__/index.php?g=wap&m=mall&a=buy&mt=<{:time()}>&goods_id=<{$detail.goods_id}>&num=' + num<if condition='$spec_goods_price' >+'&spec_key='+spec_key</if>;
                                $.get(url, function (data) {
                                    if (data.status == 'success') {
                                        layer.msg(data.msg);
                                        setTimeout(function(){
                                            window.location.href=data.url;
                                        },2000);  
                                    } else {
                                       layer.msg(data.msg);
                                    }
                                }, 'json');

                            });
        });
    </script>

<script type="text/javascript">
	$(document).ready(function(){   
    // 更新商品价格
   get_goods_price();
});
function switch_spec(spec)
{
    $(spec).siblings().removeClass('hover');
    $(spec).addClass('hover');
	$(spec).siblings().children('input').prop('checked',false);
	$(spec).children('input').prop('checked',true);	
    //更新商品价格
    get_goods_price();
}

function get_goods_price(){
  var goods_price = <{$goods["mall_price"] }>; // 商品起始价
  //这个先保留了
 var store_count = <{$detail['num']}>; // 商品起始库存   
   var spec_goods_price = '';
  <if condition="!empty($spec_goods_price)">
    spec_goods_price =<{$spec_goods_price}>;  // 规格 对应 价格 库存表   //alert(spec_goods_price['28_100']['price']);    
   </if>
    // 如果有属性选择项
   // 如果有属性选择项
	if(spec_goods_price != null){
		goods_spec_arr = new Array();
		$("input[name^='goods_spec']:checked").each(function(){
			 goods_spec_arr.push($(this).val());
		});    
		spec_key = goods_spec_arr.sort(sortNumber).join('_');  //排序后组合成 key	 搞一下就成了全局变量了
		goods_price = spec_goods_price[spec_key]['price']; // 找到对应规格的价格		
		store_count = spec_goods_price[spec_key]['store_count']; // 找到对应规格的库存
	}
	var goods_num = parseInt($("#goods_num").val()); 
	// 库存不足的情况
	if(goods_num > store_count)
	{
	   goods_num = store_count;
	   alert('库存仅剩 '+store_count+' 件');
	   $("#goods_num").val(goods_num);
	}	
	$("#goods_price").html('￥'+goods_price+'元'); // 变动价格显示
	    $("#stock").html(store_count);

	}

	function sortNumber(a,b) { 
		return a - b; 
	} 


	function goods_cut(){
  		var num_val=document.getElementById('goods_num');  
  		var new_num=num_val.value;  
  		var Num = parseInt(new_num);  
  		if(Num>1)Num=Num-1;  
  		num_val.value=Num;
  	}  
  	function goods_add(){
  		var num_val=document.getElementById('goods_num'); 
  		var new_num=num_val.value;  
  		var Num = parseInt(new_num);  
  		Num=Num+1;  num_val.value=Num;
  	} 
  	

</script>
<iframe id="x-frame" name="x-frame" style="display:none;"></iframe>	
</body>
</html>

<include file="public:footer_share"/>